/* global BigInt */
import "../styles.css";
import React, { useContext, useEffect, useState } from 'react';
import { getAllCommitments, getCommitmnetCnt, setContractIns } from "../core/web3/contractL2";
import { myContext } from "../App";
import { getContractAddress } from "../core/http/http";

export const testCommitmentArray = [
  [
    '993381692017950907280477496161827207191495973491531754278415681232369201900',
    '19850751609954646487727642737331830826450870526326468903565300908211599615204',
  ],
  [
    '1807915812435637782925383775539622374809576430692037528882802798810055056633',
    '9278535119075040508095625451630349976977040071178100640009466504811258671086',
  ],
  [
    '5500539307153904278652358985003706414390640907567849134338910815149470786059',
    '10317380630460235543025439489464710807276649523535726863730226375845136410403',
  ],
  [
    '17155422325232827519030404821961001301945486335686243146499169768229367577299',
    '7647858590629439339431243238282913427038518434418126470515773641037449682148',
  ],
  [
    '9272261161247752073947606321897032320484016464846806447015192113085058747180',
    '16605116927171407489331314194975647319505609236473946391213273810544445133284',
  ],
  [
    '18079072969140518176039477541486523454547602126065747490519942788028999697059',
    '11599552873324729312038973510252002273956281342037488787559220262580214138060',
  ],
  [
    '16653878450252784398949077033828162105864008786109618833307198296315833632622',
    '12730852013657868461215704899098068518998924085855808060546892252505890463639',
  ],
  [
    '358124856823911466952882976551115432755310454689743152626380267379054207652',
    '12458705030068360421391490412908821238319886554311909988783449938884189675339',
  ],
  [
    '7317505402087385646849270810118371634846780364037472767260033866330408226864',
    '14167620125423946768535244022131847538134876302998255194199709799673899911073',
  ],
  [
    '19322780624076439877752144230510104676572459345329865315559254767662086999334',
    '3940581952296575634595530888494823863121808797061188317205767083772779666256',
  ]
]

export const loadCommitment = async () => {
  return await getAllCommitments();
};

export default () => {
  const {commitmentArray, setCommitmentArray} = useContext(myContext);

  const decTohex = (decStr, padSize = 77) => {
    return BigInt(decStr).toString(10).toUpperCase().padStart(padSize, '0');
  }

  useEffect(() => {
    const timer = setInterval(async () => {
      // setContractIns(await getContractAddress());
      setCommitmentArray(await loadCommitment());
    }, 3333);

    return () => {
      clearInterval(timer)
    };
  }, [commitmentArray])

  const CommitmentArrayComp = () => {
    if(commitmentArray === undefined) return <div></div>;
    return (
      <div className="commitment">
        {
          commitmentArray.map((val, ind) => (
            <div
              key={ind}
              className="commitment__element"
            >
              {ind+1 + ' :  (' + decTohex(val[0]) + ',' + decTohex(val[1]) + ")"} </div>
          ))
        }
        <br />
      </div>
    )
  }

  return (
    <CommitmentArrayComp />
  );
}

